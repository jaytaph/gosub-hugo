<script>
    (function () {
        const root = document.documentElement;
        const key = "gosub.theme";
        const btn = document.getElementById("themeToggle");
        const label = document.getElementById("themeLabel");

        if (!btn) return;

        function setTheme(t){
            if (!t) {
                root.removeAttribute("data-theme");
                localStorage.removeItem(key);
                label.textContent = "Theme";
                return;
            }
            root.setAttribute("data-theme", t);
            localStorage.setItem(key, t);
            label.textContent = (t === "light") ? "Light" : "Dark";
        }

        const saved = localStorage.getItem(key);
        if (saved === "light" || saved === "dark") setTheme(saved);

        btn.addEventListener("click", () => {
            const cur = root.getAttribute("data-theme");
            if (!cur) {
                const sysDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
                setTheme(sysDark ? "light" : "dark");
                return;
            }
            setTheme(cur === "dark" ? "light" : "dark");
        });
    })();
</script>
